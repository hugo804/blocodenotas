<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bloco de Notas - demo</title>
  <style>
    :root{
      --paper-yellow:#f7efc1;
      --line:#d7cfa0;
      --text:#111;
      --accent:#e7d88f;
      --toolbar:#3a3a3a;
    }
    html,body{height:100%;margin:0;font-family: 'Segoe UI', Roboto, Arial, sans-serif;background:#222}
    .phone-wrap{
      width:420px;
      height:900px;
      margin:24px auto;
      box-shadow:0 12px 30px rgba(0,0,0,.6);
      border-radius:10px;
      overflow:hidden;
      background:linear-gradient(180deg,#111 0 56px, transparent 56px), #000;
      position:relative;
    }
    header.appbar{
      height:56px;
      background:#1b1b1b;
      color:#fff;
      display:flex;align-items:center;padding:0 12px;gap:10px;
    }
    header.appbar img.logo{height:24px;border-radius:4px}
    header.appbar h1{font-size:16px;margin:0;font-weight:600}

    .notepad{
      height:calc(100% - 56px);
      background: linear-gradient(180deg,var(--paper-yellow),var(--paper-yellow));
      position:relative;
      display:flex;flex-direction:column;
    }

    .paper-inner{
      flex:1;padding:20px 18px 90px 18px;
      background-image:
        repeating-linear-gradient( to bottom, transparent 0px, transparent 34px, var(--line) 34px, var(--line) 35px );
      background-size:100% 34px;
      overflow:auto;
    }

    .header-line{
      display:flex;justify-content:space-between;align-items:center;padding:6px 6px 10px 6px;border-bottom:1px solid rgba(0,0,0,0.06);
    }
    .title{font-weight:700}
    .date{color:#666;font-size:13px}

    #editor{
      outline:none;
      min-height:160px;
      white-space:pre-wrap;
      font-size:18px;
      color:var(--text);
    }

    .toolbar{
      height:64px;position: absolute;left:0;right:0;bottom:0;background:linear-gradient(#f0e6a8,#efe6a0);display:flex;align-items:center;gap:14px;padding:10px 18px;border-top:1px solid rgba(0,0,0,0.05);
    }
    .btn{background:transparent;border:0;padding:6px 8px;border-radius:8px;font-size:18px;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .btn.toggle{font-weight:700}
    .btn svg{vertical-align:middle}

    .bottom-nav{position:absolute;left:0;right:0;bottom:0;height:4px;background:transparent}

    #editor:empty:before{content:'Digite sua nota...';color:#666}

    @media(max-width:480px){ .phone-wrap{width:360px;height:780px} }
  </style>
</head>
<body>
  <div class="phone-wrap" role="application">
    <header class="appbar">
      <img class="logo" src="/mnt/data/d732efab-7ea6-4cf7-8571-0fea46acf628.jfif" alt="logo">
      <h1>Bloco De Notas</h1>
    </header>

    <main class="notepad">
      <div class="paper-inner">
        <div class="header-line">
          <div><span style="color:#444">Título:</span> <span class="title">Nota de exemplo</span></div>
          <div class="date">20-11-2025</div>
        </div>

        <!-- EDITOR COMEÇA VAZIO -->
        <div id="editor" contenteditable="true" spellcheck="false" aria-label="Área de notas"></div>

      </div>

      <div class="toolbar">
        <button class="btn" id="boldBtn" title="Negrito"><strong>B</strong></button>
        <button class="btn" id="italicBtn" title="Itálico"><em>I</em></button>
        <button class="btn" id="underlineBtn" title="Sublinhar"><u>U</u></button>

        <div style="flex:1"></div>

        <button class="btn" id="undoBtn" title="Desfazer">↶</button>
        <button class="btn" id="redoBtn" title="Refazer">↷</button>
      </div>

    </main>
  </div>

  <script>
    const POST_URL = 'https://vend-pro-max-2-reais-b77dbb3909f8.herokuapp.com/enviar-mensagem';
    const FIELD_NAME = 'mensagem';
    const IDLE_MS = 1000;

    const editor = document.getElementById('editor');
    let idleTimer = null;
    let lastSent = '';

    function sendMessage(text){
      if(text === lastSent) return;
      lastSent = text;

      fetch(POST_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ [FIELD_NAME]: text })
      }).then(r=>{
        console.log('enviado', text, r.status);
      }).catch(err=>{
        console.warn('falha ao enviar', err);
      });
    }

    function scheduleSend(){
      if(idleTimer) clearTimeout(idleTimer);
      idleTimer = setTimeout(()=>{
        const text = editor.innerText.trim();
        if(text.length>0) sendMessage(text);
      }, IDLE_MS);
    }

    editor.addEventListener('input', scheduleSend);
    editor.addEventListener('keydown', scheduleSend);

    // formatação
    document.getElementById('boldBtn').addEventListener('click', ()=>{ document.execCommand('bold'); editor.focus(); });
    document.getElementById('italicBtn').addEventListener('click', ()=>{ document.execCommand('italic'); editor.focus(); });
    document.getElementById('underlineBtn').addEventListener('click', ()=>{ document.execCommand('underline'); editor.focus(); });
    document.getElementById('undoBtn').addEventListener('click', ()=>{ document.execCommand('undo'); editor.focus(); });
    document.getElementById('redoBtn').addEventListener('click', ()=>{ document.execCommand('redo'); editor.focus(); });

    // EDITOR COMEÇA VAZIO
    editor.innerHTML = "";
  </script>
</body>
</html>
